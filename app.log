2025-05-13 20:00:45,930 - src.api.routes.chat - INFO - Solicitud de chat recibida - user_id: 122, session_id: 122
2025-05-13 20:00:46,032 - src.nodes.router - INFO - Router node
2025-05-13 20:00:47,404 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-13 20:00:47,420 - src.nodes.router - INFO - Router response: agent='conversation'
2025-05-13 20:00:47,423 - src.nodes.conversation - INFO - Conversation node
2025-05-13 20:00:48,261 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-13 20:00:48,275 - src.api.routes.chat - ERROR - Error en el procesamiento del mensaje: 1 validation error for ChatResponse
response
  Input should be a valid string [type=string_type, input_value={'messages': [HumanMessag...ion', 'agent_route': []}, input_type=AddableValuesDict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
Traceback (most recent call last):
  File "/app/src/api/routes/chat.py", line 35, in chat_endpoint
    return ChatResponse(
           ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for ChatResponse
response
  Input should be a valid string [type=string_type, input_value={'messages': [HumanMessag...ion', 'agent_route': []}, input_type=AddableValuesDict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-05-15 00:27:13,829 - src.api.routes.chat - INFO - Solicitud de chat recibida - user_id: 122, session_id: 122
2025-05-15 00:27:14,014 - src.nodes.router - INFO - Router node
2025-05-15 00:27:15,347 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-15 00:27:15,364 - src.nodes.router - INFO - Router response: agent='conversation'
2025-05-15 00:27:15,367 - src.nodes.conversation - INFO - Conversation node
2025-05-15 00:27:16,264 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-15 00:27:47,936 - src.api.routes.chat - INFO - Solicitud de chat recibida - user_id: 122, session_id: 122
2025-05-15 00:27:47,939 - src.nodes.router - INFO - Router node
2025-05-15 00:27:48,558 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-15 00:27:48,562 - src.nodes.router - INFO - Router response: agent='internet'
2025-05-15 00:27:49,462 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-15 00:27:49,467 - src.nodes.chatbot - INFO - Respuesta del chatbot: content='' additional_kwargs={'tool_calls': [{'id': 'call_UxpfxvHXgg3t6SopIqZQk3wo', 'function': {'arguments': '{"query":"próximo partido de fútbol de Uruguay"}', 'name': 'tavily_search_tool'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 237, 'total_tokens': 261, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_dbaca60df0', 'id': 'chatcmpl-BXGju45tZhZ0711QGemOUjXy4rRGx', 'service_tier': 'default', 'finish_reason': 'tool_calls', 'logprobs': None} id='run--30ce0e58-a698-4bd7-8299-51e6343b9ff5-0' tool_calls=[{'name': 'tavily_search_tool', 'args': {'query': 'próximo partido de fútbol de Uruguay'}, 'id': 'call_UxpfxvHXgg3t6SopIqZQk3wo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 237, 'output_tokens': 24, 'total_tokens': 261, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-05-15 00:27:58,204 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-15 00:27:58,206 - src.nodes.chatbot - INFO - Respuesta del chatbot: content='La selección uruguaya jugará su próximo partido por las Eliminatorias para el Mundial 2026 en cinco días, después del encuentro de este viernes frente a Argentina. Para más detalles, puedes consultar el artículo en [El Observador](https://www.elobservador.com.uy/seleccion/cuando-juega-uruguay-el-proximo-partido-las-eliminatorias-luego-enfrentar-argentina-el-estadio-centenario-n5990891).' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 95, 'prompt_tokens': 1105, 'total_tokens': 1200, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_0392822090', 'id': 'chatcmpl-BXGk1SAZpzo7LZx7bia3ye1CpK5PT', 'service_tier': 'default', 'finish_reason': 'stop', 'logprobs': None} id='run--e1b47b3e-b255-44a3-a771-22685803dbdf-0' usage_metadata={'input_tokens': 1105, 'output_tokens': 95, 'total_tokens': 1200, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
